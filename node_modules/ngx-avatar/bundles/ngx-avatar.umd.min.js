!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@angular/common"),require("is-retina"),require("ts-md5/dist/md5"),require("@angular/common/http"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-avatar",["exports","@angular/core","@angular/common","is-retina","ts-md5/dist/md5","@angular/common/http","rxjs/operators"],r):r((t=t||self)["ngx-avatar"]={},t.ng.core,t.ng.common,t.isRetina,t.md5,t.ng.common.http,t.rxjs.operators)}(this,function(t,r,e,o,n,i,s){"use strict";o=o&&o.hasOwnProperty("default")?o["default"]:o;var a=function(t,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(t,r)};function u(t,r){function e(){this.constructor=t}a(t,r),t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}var c=function(){return(c=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var n in r=arguments[e])Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);return t}).apply(this,arguments)};function p(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var o,n,i=e.call(t),s=[];try{for(;(void 0===r||r-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(a){n={error:a}}finally{try{o&&!o.done&&(e=i["return"])&&e.call(i)}finally{if(n)throw n.error}}return s}function h(){for(var t=[],r=0;r<arguments.length;r++)t=t.concat(p(arguments[r]));return t}var l=function(){return function(t){this.sourceId=t}}(),f={FACEBOOK:"facebook",GOOGLE:"google",TWITTER:"twitter",VKONTAKTE:"vkontakte",SKYPE:"skype",GRAVATAR:"gravatar",GITHUB:"github",CUSTOM:"custom",INITIALS:"initials",VALUE:"value"},v=function(){function t(t){this.sourceId=t,this.sourceType=f.FACEBOOK}return t.prototype.getAvatar=function(t){return"https://graph.facebook.com/"+this.sourceId+"/picture?width="+t+"&height="+t},t}(),y=function(){function t(t){this.sourceId=t,this.sourceType=f.TWITTER}return t.prototype.getAvatar=function(t){var r=this.getImageSize(t);return"https://twitter.com/"+this.sourceId+"/profile_image?size="+r},t.prototype.getImageSize=function(t){return t<=24?"mini":t<=48?"normal":t<=73?"bigger":"original"},t}(),d=function(t){function r(r){var e=t.call(this,r)||this;return e.sourceType=f.GOOGLE,e}return u(r,t),r.prototype.getAvatar=function(){return"https://picasaweb.google.com/data/entry/api/user/"+this.sourceId+"?alt=json"},r.prototype.processResponse=function(t,r){var e=t.entry.gphoto$thumbnail.$t;if(e)return e.replace("s64","s"+r)},r}(l),g=function(){function t(t){this.sourceId=t,this.sourceType=f.CUSTOM}return t.prototype.getAvatar=function(){return this.sourceId},t}(),I=function(){function t(t){this.sourceId=t,this.sourceType=f.INITIALS}return t.prototype.getAvatar=function(t){return this.getInitials(this.sourceId,t)},t.prototype.getInitials=function(t,r){if(!(t=t?t.trim():null))return"";var e=t.split(" ");return r&&r<e.length?this.constructInitials(e.slice(0,r)):this.constructInitials(e)},t.prototype.constructInitials=function(t){return t&&t.length?t.filter(function(t){return t&&t.length>0}).map(function(t){return t[0].toUpperCase()}).join(""):""},t}(),A=function(){function t(t){this.value=t,this.sourceType=f.GRAVATAR,this.sourceId=t.match("^[a-f0-9]{32}$")?t:n.Md5.hashStr(t).toString()}return t.prototype.getAvatar=function(t){var r=o()?2*t:t;return"https://secure.gravatar.com/avatar/"+this.sourceId+"?s="+r+"&d=404"},t}(),S=function(){function t(t){this.sourceId=t,this.sourceType=f.SKYPE}return t.prototype.getAvatar=function(){return"https://api.skype.com/users/"+this.sourceId+"/profile/avatar"},t}(),m=function(){function t(t){this.sourceId=t,this.sourceType=f.VALUE}return t.prototype.getAvatar=function(){return this.sourceId},t}(),T=function(t){function r(r){var e=t.call(this,r)||this;return e.sourceType=f.VKONTAKTE,e}return u(r,t),r.prototype.getAvatar=function(t){var r=this.getImageSize(t);return"https://api.vk.com/method/users.get?user_id="+this.sourceId+"&v=5.8&fields="+r},r.prototype.processResponse=function(t){var r=Object.keys(t.response[0]).pop();return t.response[0][r]},r.prototype.getImageSize=function(t){return t<=50?"photo_50":t<=100?"photo_100":t<=200?"photo_200":"photo_max"},r}(l),C=function(t){function r(r){var e=t.call(this,r)||this;return e.sourceType=f.GITHUB,e}return u(r,t),r.prototype.getAvatar=function(){return"https://api.github.com/users/"+this.sourceId},r.prototype.processResponse=function(t,r){return r?t.avatar_url+"&s="+r:t.avatar_url},r}(l),b=function(){function t(){this.sources={},this.sources[f.FACEBOOK]=v,this.sources[f.TWITTER]=y,this.sources[f.GOOGLE]=d,this.sources[f.SKYPE]=S,this.sources[f.GRAVATAR]=A,this.sources[f.CUSTOM]=g,this.sources[f.INITIALS]=I,this.sources[f.VALUE]=m,this.sources[f.VKONTAKTE]=T,this.sources[f.GITHUB]=C}return t.prototype.newInstance=function(t,r){return new this.sources[t](r)},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[]},t}(),O=new r.InjectionToken("avatar.config"),x=function(){function t(t){this.userConfig=t}return t.prototype.getAvatarSources=function(t){if(this.userConfig&&this.userConfig.sourcePriorityOrder&&this.userConfig.sourcePriorityOrder.length){var r=h(new Set(this.userConfig.sourcePriorityOrder)).filter(function(r){return t.includes(r)});return h(r,t.filter(function(t){return!r.includes(t)}))}return t},t.prototype.getAvatarColors=function(t){return this.userConfig&&this.userConfig.colors&&this.userConfig.colors.length&&this.userConfig.colors||t},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:r.Optional},{type:r.Inject,args:[O]}]}]},t}(),R=[f.FACEBOOK,f.GOOGLE,f.TWITTER,f.VKONTAKTE,f.SKYPE,f.GRAVATAR,f.GITHUB,f.CUSTOM,f.INITIALS,f.VALUE],E=["#1abc9c","#3498db","#f1c40f","#8e44ad","#e74c3c","#d35400","#2c3e50","#7f8c8d"],k=function(){function t(t,r){this.http=t,this.avatarConfigService=r,this.avatarSources=R,this.avatarColors=E,this.overrideAvatarSources(),this.overrideAvatarColors()}return t.prototype.fetchAvatar=function(t){return this.http.get(t)},t.prototype.getRandomColor=function(t){if(!t)return"transparent";var r=this.calculateAsciiCode(t);return this.avatarColors[r%this.avatarColors.length]},t.prototype.copmareSources=function(t,r){return this.getSourcePriority(t)-this.getSourcePriority(r)},t.prototype.isSource=function(t){return this.avatarSources.includes(t)},t.prototype.isTextAvatar=function(t){return[f.INITIALS,f.VALUE].includes(t)},t.prototype.overrideAvatarSources=function(){this.avatarSources=this.avatarConfigService.getAvatarSources(R)},t.prototype.overrideAvatarColors=function(){this.avatarColors=this.avatarConfigService.getAvatarColors(E)},t.prototype.calculateAsciiCode=function(t){return t.split("").map(function(t){return t.charCodeAt(0)}).reduce(function(t,r){return t+r})},t.prototype.getSourcePriority=function(t){return this.avatarSources.indexOf(t)},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:x}]},t}(),z=function(){function t(t,e,o){this.elementRef=t,this.sourceFactory=e,this.avatarService=o,this.round=!0,this.size=50,this.textSizeRatio=3,this.fgColor="#FFF",this.style={},this.cornerRadius=0,this.clickOnAvatar=new r.EventEmitter,this.isAlive=!0,this.avatarStyle={},this.hostStyle={},this.currentSource=0,this.sources=Array()}return t.prototype.onAvatarClicked=function(){this.clickOnAvatar.emit(this.sources[this.currentSource-1])},t.prototype.ngOnChanges=function(t){for(var r in t)if(this.avatarService.isSource(r)&&t[r].currentValue){var e=t[r].currentValue;this.addSource(f[r.toUpperCase()],e)}this.initializeAvatar()},t.prototype.fetchAvatarSource=function(t){var r=this.sources[this.currentSource];r&&(this.avatarService.isTextAvatar(r.sourceType)?(this.buildTextAvatar(r),this.avatarSrc=undefined):this.buildImageAvatar(r),this.currentSource++)},t.prototype.ngOnDestroy=function(){this.isAlive=!1},t.prototype.initializeAvatar=function(){this.currentSource=0,this.sources.length>0&&this.sources[this.currentSource]&&(this.sortAvatarSources(),this.fetchAvatarSource(),this.hostStyle={width:this.size+"px",height:this.size+"px"})},t.prototype.sortAvatarSources=function(){var t=this;this.sources.sort(function(r,e){return t.avatarService.copmareSources(r.sourceType,e.sourceType)})},t.prototype.buildTextAvatar=function(t){this.avatarText=t.getAvatar(this.initialsSize),this.avatarStyle=this.getInitialsStyle(t.sourceId)},t.prototype.buildImageAvatar=function(t){this.avatarStyle=this.getImageStyle(),t instanceof l?this.fetchAndProcessAsyncAvatar(t):this.avatarSrc=t.getAvatar(this.size)},t.prototype.getInitialsStyle=function(t){return c({textAlign:"center",borderRadius:this.round?"100%":this.cornerRadius+"px",border:this.borderColor?"1px solid "+this.borderColor:"",textTransform:"uppercase",color:this.fgColor,backgroundColor:this.bgColor?this.bgColor:this.avatarService.getRandomColor(t),font:Math.floor(this.size/this.textSizeRatio)+"px Helvetica, Arial, sans-serif",lineHeight:this.size+"px"},this.style)},t.prototype.getImageStyle=function(){return c({maxWidth:"100%",borderRadius:this.round?"50%":this.cornerRadius+"px",border:this.borderColor?"1px solid "+this.borderColor:"",width:this.size,height:this.size},this.style)},t.prototype.fetchAndProcessAsyncAvatar=function(t){var r=this;this.avatarService.fetchAvatar(t.getAvatar()).pipe(s.takeWhile(function(){return r.isAlive}),s.map(function(e){return t.processResponse(e,r.size)})).subscribe(function(t){return r.avatarSrc=t},function(r){console.error("ngx-avatar: error while fetching "+t.sourceType+" avatar ")})},t.prototype.addSource=function(t,r){if(this.isSourceExist(t)){var e=this.sources.findIndex(function(r){return r.sourceType===t});this.sources[e].sourceId=r}else this.sources.push(this.sourceFactory.newInstance(t,r))},t.prototype.isSourceExist=function(t){return this.sources.map(function(t){return t.sourceType}).includes(t)},t.decorators=[{type:r.Component,args:[{selector:"ngx-avatar",template:'\n    <div\n      (click)="onAvatarClicked()"\n      class="avatar-container"\n      [ngStyle]="hostStyle"\n    >\n      <img\n        *ngIf="avatarSrc; else textAvatar"\n        [src]="avatarSrc"\n        [width]="size"\n        [height]="size"\n        [ngStyle]="avatarStyle"\n        (error)="fetchAvatarSource($event)"\n        class="avatar-content"\n      />\n      <ng-template #textAvatar>\n        <div *ngIf="avatarText" class="avatar-content" [ngStyle]="avatarStyle">\n          {{ avatarText }}\n        </div>\n      </ng-template>\n    </div>\n  ',styles:["\n      :host {\n        border-radius: '50%';\n      }\n    "]}]}],t.ctorParameters=function(){return[{type:r.ElementRef},{type:b},{type:k}]},t.propDecorators={round:[{type:r.Input}],size:[{type:r.Input}],textSizeRatio:[{type:r.Input}],bgColor:[{type:r.Input}],fgColor:[{type:r.Input}],borderColor:[{type:r.Input}],style:[{type:r.Input}],cornerRadius:[{type:r.Input}],facebook:[{type:r.Input,args:["facebookId"]}],twitter:[{type:r.Input,args:["twitterId"]}],google:[{type:r.Input,args:["googleId"]}],vkontakte:[{type:r.Input,args:["vkontakteId"]}],skype:[{type:r.Input,args:["skypeId"]}],gravatar:[{type:r.Input,args:["gravatarId"]}],github:[{type:r.Input,args:["githubId"]}],custom:[{type:r.Input,args:["src"]}],initials:[{type:r.Input,args:["name"]}],value:[{type:r.Input,args:["value"]}],placeholder:[{type:r.Input,args:["placeholder"]}],initialsSize:[{type:r.Input,args:["initialsSize"]}],clickOnAvatar:[{type:r.Output}]},t}(),w=function(){function t(){}return t.forRoot=function(r){return{ngModule:t,providers:[{provide:O,useValue:r||{}}]}},t.decorators=[{type:r.NgModule,args:[{imports:[e.CommonModule],declarations:[z],providers:[b,k,x],exports:[z]}]}],t}();t.AvatarComponent=z,t.AvatarModule=w,t.AvatarService=k,t.AvatarSource=f,t.defaultColors=E,t.defaultSources=R,t.ɵa=b,t.ɵb=x,t.ɵc=O,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-avatar.umd.min.js.map